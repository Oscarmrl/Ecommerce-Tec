generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Category {
  id          String    @id @default(cuid())
  name        String
  slug        String    @unique
  description String?
  image       String?
  icon        String?   // Icono para la UI
  parentId    String?   // Para subcategorías
  parent      Category? @relation("CategoryChildren", fields: [parentId], references: [id])
  children    Category[] @relation("CategoryChildren")
  products    Product[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@map("categories")
}

model Product {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  description String?
  shortDescription String?
  price       Decimal  @db.Decimal(10, 2)
  comparePrice Decimal? @db.Decimal(10, 2)
  images      String[]
  categoryId  String
  category    Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  variants    ProductVariant[]
  reviews     Review[]
  cartItems   CartItem[]
  orderItems  OrderItem[]
  featured    Boolean  @default(false)
  inventory   Int      @default(0)
  rating      Float?   @default(0)
  tags        String[]
  
  // Especificaciones para computadoras
  brand       String?  // Apple, Dell, HP, Lenovo, etc.
  processor   String?  // Intel Core i7, AMD Ryzen 9, etc.
  ram         String?  // 16GB, 32GB, etc.
  storage     String?  // 512GB SSD, 1TB HDD, etc.
  graphics    String?  // NVIDIA RTX 4060, AMD Radeon, etc.
  display     String?  // 14" FHD, 15.6" 4K, etc.
  os          String?  // Windows 11, macOS, Linux
  weight      String?  // 1.5kg, 2.3kg, etc.
  battery     String?  // 8 horas, 12 horas, etc.
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("products")
}

model ProductVariant {
  id        String   @id @default(cuid())
  productId String
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  name      String   // Ej: "Color", "RAM", "Storage"
  value     String   // Ej: "Negro", "16GB", "1TB SSD"
  price     Decimal? @db.Decimal(10, 2)
  inventory Int      @default(0)
  sku       String?  @unique
  cartItems CartItem[]
  orderItems OrderItem[]

  @@map("product_variants")
}

model Cart {
  id        String    @id @default(cuid())
  userId    String?
  user      User?     @relation(fields: [userId], references: [id], onDelete: Cascade)
  sessionId String?   // Para usuarios no autenticados
  items     CartItem[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@map("carts")
}

model CartItem {
  id        String   @id @default(cuid())
  cartId    String
  cart      Cart     @relation(fields: [cartId], references: [id], onDelete: Cascade)
  productId String
  product   Product  @relation(fields: [productId], references: [id])
  variantId String?
  variant   ProductVariant? @relation(fields: [variantId], references: [id])
  quantity  Int      @default(1)
  
  @@unique([cartId, productId, variantId])
  @@map("cart_items")
}

model Review {
  id        String   @id @default(cuid())
  productId String
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  userId    String?
  userName  String
  userEmail String
  rating    Int      @default(5)
  comment   String?
  approved  Boolean  @default(false)
  createdAt DateTime @default(now())

  @@map("reviews")
}

model User {
  id        String    @id @default(cuid())
  email     String    @unique
  name      String?
  image     String?
  phone     String?
  password  String?   // Para autenticación con credenciales
  role      String    @default("USER") // USER o ADMIN
  addresses Address[]
  orders    Order[]
  carts     Cart[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@map("users")
}

model Address {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  street      String
  city        String
  state       String
  postalCode  String
  country     String
  phone       String?
  isDefault   Boolean  @default(false)
  shippingOrders Order[] @relation("OrderShippingAddress")
  billingOrders  Order[] @relation("OrderBillingAddress")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("addresses")
}

model Order {
  id           String        @id @default(cuid())
  userId       String?
  user         User?         @relation(fields: [userId], references: [id], onDelete: SetNull)
  orderNumber  String        @unique
  items        OrderItem[]
  total        Decimal       @db.Decimal(10, 2)
  status       OrderStatus   @default(PENDING)
  shippingAddressId String?
  shippingAddress Address?   @relation("OrderShippingAddress", fields: [shippingAddressId], references: [id])
  billingAddressId String?
  billingAddress  Address?   @relation("OrderBillingAddress", fields: [billingAddressId], references: [id])
  paymentMethod String?
  paymentStatus PaymentStatus @default(PENDING)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  @@map("orders")
}

model OrderItem {
  id        String   @id @default(cuid())
  orderId   String
  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  productId String
  product   Product  @relation(fields: [productId], references: [id])
  variantId String?
  variant   ProductVariant? @relation(fields: [variantId], references: [id])
  quantity  Int      @default(1)
  price     Decimal  @db.Decimal(10, 2)

  @@map("order_items")
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
}