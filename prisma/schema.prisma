generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Category {
  id          String     @id @default(cuid())
  name        String
  slug        String     @unique
  description String?
  image       String?
  icon        String?
  parentId    String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  parent      Category?  @relation("CategoryChildren", fields: [parentId], references: [id])
  children    Category[] @relation("CategoryChildren")
  products    Product[]

  @@map("categories")
}

model Product {
  id               String           @id @default(cuid())
  name             String
  slug             String           @unique
  description      String?
  shortDescription String?
  price            Decimal          @db.Decimal(10, 2)
  comparePrice     Decimal?         @db.Decimal(10, 2)
  images           String[]
  categoryId       String
  featured         Boolean          @default(false)
  inventory        Int              @default(0)
  rating           Float?           @default(0)
  tags             String[]
  brand            String?
  processor        String?
  ram              String?
  storage          String?
  graphics         String?
  display          String?
  os               String?
  weight           String?
  battery          String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  cartItems        CartItem[]
  orderItems       OrderItem[]
  variants         ProductVariant[]
  category         Category         @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  reviews          Review[]

  @@map("products")
}

model ProductVariant {
  id         String      @id @default(cuid())
  productId  String
  name       String
  value      String
  price      Decimal?    @db.Decimal(10, 2)
  inventory  Int         @default(0)
  sku        String?     @unique
  cartItems  CartItem[]
  orderItems OrderItem[]
  product    Product     @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("product_variants")
}

model Cart {
  id        String     @id @default(cuid())
  userId    String?
  sessionId String?
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  items     CartItem[]
  user      User?      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("carts")
}

model CartItem {
  id        String          @id @default(cuid())
  cartId    String
  productId String
  variantId String?
  quantity  Int             @default(1)
  cart      Cart            @relation(fields: [cartId], references: [id], onDelete: Cascade)
  product   Product         @relation(fields: [productId], references: [id])
  variant   ProductVariant? @relation(fields: [variantId], references: [id])

  @@unique([cartId, productId, variantId])
  @@map("cart_items")
}

model Review {
  id        String   @id @default(cuid())
  productId String
  userId    String?
  userName  String
  userEmail String
  rating    Int      @default(5)
  comment   String?
  approved  Boolean  @default(false)
  createdAt DateTime @default(now())
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("reviews")
}

model User {
  id        String    @id @default(cuid())
  email     String    @unique
  name      String?
  image     String?
  phone     String?
  password  String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  role      String    @default("USER")
  addresses Address[]
  carts     Cart[]
  orders    Order[]

  @@map("users")
}

model Address {
  id             String   @id @default(cuid())
  userId         String
  street         String
  city           String
  state          String
  postalCode     String
  country        String
  phone          String?
  isDefault      Boolean  @default(false)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  billingOrders  Order[]  @relation("OrderBillingAddress")
  shippingOrders Order[]  @relation("OrderShippingAddress")

  @@map("addresses")
}

model Order {
  id                String        @id @default(cuid())
  userId            String?
  orderNumber       String        @unique
  total             Decimal       @db.Decimal(10, 2)
  status            OrderStatus   @default(PENDING)
  shippingAddressId String?
  billingAddressId  String?
  paymentMethod     String?
  paymentStatus     PaymentStatus @default(PENDING)
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  items             OrderItem[]
  billingAddress    Address?      @relation("OrderBillingAddress", fields: [billingAddressId], references: [id])
  shippingAddress   Address?      @relation("OrderShippingAddress", fields: [shippingAddressId], references: [id])
  user              User?         @relation(fields: [userId], references: [id])

  @@map("orders")
}

model OrderItem {
  id        String          @id @default(cuid())
  orderId   String
  productId String
  variantId String?
  quantity  Int             @default(1)
  price     Decimal         @db.Decimal(10, 2)
  order     Order           @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product   Product         @relation(fields: [productId], references: [id])
  variant   ProductVariant? @relation(fields: [variantId], references: [id])

  @@map("order_items")
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
}
